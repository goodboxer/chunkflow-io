const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/components-Db2zrr2m.js","assets/vendor_vue-DGwlV1SQ.js","assets/vendor_firebase_firestore-VD6RhEoE.js","assets/vendor_firebase_app-YLVDrfJD.js","assets/vendor_firebase_misc-rlVDSRsL.js","assets/vendor_misc-BXWtuYvb.js","assets/vendor_firebase_auth-B-CTh_QA.js"])))=>i.map(i=>d[i]);
import{r as a,o as Re,a as Ce,b as st,d as _e,e as lt,c as de,w as ct,n as dt}from"./vendor_vue-DGwlV1SQ.js";import{S as we,G as ve,T as O,M as je,E as ut}from"./vendor_genai-CLscWybu.js";import{g as pt,o as ht,U as gt,A as ft}from"./components-Db2zrr2m.js";import"./vendor_firebase_firestore-VD6RhEoE.js";import"./vendor_firebase_auth-B-CTh_QA.js";import"./vendor_firebase_app-YLVDrfJD.js";import"./vendor_firebase_misc-rlVDSRsL.js";import"./vendor_misc-BXWtuYvb.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))l(r);new MutationObserver(r=>{for(const f of r)if(f.type==="childList")for(const g of f.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&l(g)}).observe(document,{childList:!0,subtree:!0});function i(r){const f={};return r.integrity&&(f.integrity=r.integrity),r.referrerPolicy&&(f.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?f.credentials="include":r.crossOrigin==="anonymous"?f.credentials="omit":f.credentials="same-origin",f}function l(r){if(r.ep)return;r.ep=!0;const f=i(r);fetch(r.href,f)}})();const mt="modulepreload",yt=function(o){return"/"+o},He={},vt=function(n,i,l){let r=Promise.resolve();if(i&&i.length>0){let g=function(p){return Promise.all(p.map(v=>Promise.resolve(v).then(m=>({status:"fulfilled",value:m}),m=>({status:"rejected",reason:m}))))};document.getElementsByTagName("link");const d=document.querySelector("meta[property=csp-nonce]"),P=(d==null?void 0:d.nonce)||(d==null?void 0:d.getAttribute("nonce"));r=g(i.map(p=>{if(p=yt(p),p in He)return;He[p]=!0;const v=p.endsWith(".css"),m=v?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${p}"]${m}`))return;const u=document.createElement("link");if(u.rel=v?"stylesheet":mt,v||(u.as="script"),u.crossOrigin="",u.href=p,P&&u.setAttribute("nonce",P),document.head.appendChild(u),v)return new Promise((I,b)=>{u.addEventListener("load",I),u.addEventListener("error",()=>b(new Error(`Unable to preload CSS for ${p}`)))})}))}function f(g){const d=new Event("vite:preloadError",{cancelable:!0});if(d.payload=g,window.dispatchEvent(d),!d.defaultPrevented)throw g}return r.then(g=>{for(const d of g||[])d.status==="rejected"&&f(d.reason);return n().catch(f)})};function wt(){const o=a(null),n=a(!1),i=a(!0);let l=null;function r(){o.value=pt(),n.value=!!o.value,l=ht(g=>{o.value=g,n.value=!!g,i.value=!1,g&&vt(async()=>{const{saveUserProfile:d,getUserProfile:P}=await import("./components-Db2zrr2m.js").then(p=>p.i);return{saveUserProfile:d,getUserProfile:P}},__vite__mapDeps([0,1,2,3,4,5,6])).then(({saveUserProfile:d,getUserProfile:P})=>{P(g.uid).then(p=>{p||d(g.uid,{email:g.email||"",displayName:g.displayName||"User",subscription:{plan:"free",status:"active",startDate:null,endDate:null},usage:{audioBooksCreated:0,audioMinutesGenerated:0,imagesGenerated:0,storageUsedMB:0}}).catch(v=>{console.error("Failed to create user profile:",v)})})})}),setTimeout(()=>{i.value=!1},1e3)}function f(){l&&l()}return Re(()=>{r()}),Ce(()=>{f()}),{currentUser:o,isAuthenticated:n,loading:i}}const bt={BASE_URL:"/",DEV:!1,GEMINI_API_KEY:"AIzaSyBWAEpTSHDKHU-R9LrzodNrcWwLu_FLFL8",MODE:"production",PROD:!0,SSR:!1,VITE_FIREBASE_API_KEY:"AIzaSyDBmw23uE_yM7NZ0YKEydWmAvUsuwX-VEI",VITE_FIREBASE_APP_ID:"1:898500597511:web:a9f0b29e7a8112328457a2",VITE_FIREBASE_AUTH_DOMAIN:"chunkflow-475417.firebaseapp.com",VITE_FIREBASE_MESSAGING_SENDER_ID:"898500597511",VITE_FIREBASE_PROJECT_ID:"chunkflow-475417",VITE_FIREBASE_STORAGE_BUCKET:"chunkflow-475417.firebasestorage.app",VITE_GEMINI_API_KEY:"AIzaSyBWAEpTSHDKHU-R9LrzodNrcWwLu_FLFL8",VITE_GITHUB_TOKEN:"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Q"};function kt(){return{isValid:!0,missingVars:[],warnings:[]}}function xt(){const o={isValid:!0,missingVars:[],warnings:[]},n={VITE_FIREBASE_API_KEY:"Firebase API Key",VITE_FIREBASE_AUTH_DOMAIN:"Firebase Auth Domain",VITE_FIREBASE_PROJECT_ID:"Firebase Project ID",VITE_FIREBASE_STORAGE_BUCKET:"Firebase Storage Bucket",VITE_FIREBASE_MESSAGING_SENDER_ID:"Firebase Messaging Sender ID",VITE_FIREBASE_APP_ID:"Firebase App ID"};for(const[i,l]of Object.entries(n))bt[i]||(o.isValid=!1,o.missingVars.push(i));return o.isValid||o.warnings.push(`Firebase configuration is incomplete. User authentication and data persistence will not work.
Set up Firebase at: https://console.firebase.google.com/
See SETUP.md for detailed instructions.`),o}function At(){const o=kt(),n=xt(),i=[...o.missingVars,...n.missingVars],l=[...o.warnings,...n.warnings];return i.length>0?(console.error("‚ùå Environment Configuration Error"),console.error("‚îÅ".repeat(50)),console.error(`
Missing environment variables:`),i.forEach(r=>{console.error(`  ‚úó ${r}`)}),console.error(`
Warnings:`),l.forEach(r=>{console.error(`
${r}`)}),console.error(`
‚îÅ`.repeat(50)),console.error("üìù Setup Instructions:"),console.error("  1. Copy .env.example to .env.local"),console.error("  2. Fill in your API keys and configuration"),console.error("  3. Restart the development server"),console.error("  4. See SETUP.md for detailed instructions"),console.error("‚îÅ".repeat(50)),St(i),!1):(console.log("‚úÖ Environment configuration validated successfully"),!0)}function St(o){const n=document.createElement("div");n.style.cssText=`
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 999999;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  `,n.innerHTML=`
    <div style="max-width: 600px; padding: 40px; text-align: center;">
      <div style="font-size: 72px; margin-bottom: 20px;">‚öôÔ∏è</div>
      <h1 style="font-size: 32px; margin-bottom: 16px; font-weight: 700;">
        Configuration Required
      </h1>
      <p style="font-size: 18px; margin-bottom: 32px; opacity: 0.9;">
        ChunkFlow-IO requires additional configuration to function properly.
      </p>
      <div style="background: rgba(0,0,0,0.2); border-radius: 12px; padding: 24px; margin-bottom: 32px; text-align: left;">
        <p style="font-size: 14px; font-weight: 600; margin-bottom: 12px;">Missing Configuration:</p>
        <ul style="font-size: 14px; opacity: 0.9; list-style: none; padding: 0;">
          ${o.map(i=>`<li style="margin-bottom: 8px;">‚úó ${i}</li>`).join("")}
        </ul>
      </div>
      <p style="font-size: 14px; opacity: 0.8;">
        Please contact the administrator or check the deployment documentation.
      </p>
    </div>
  `,document.body.appendChild(n)}const It="gemini-2.5-flash-native-audio-preview-09-2025",Et="imagen-4.0-fast-generate-001",Tt=we.START_SENSITIVITY_HIGH,Rt="click-sound.mp3",Ct="generating.mp4",Lt="logo.png",Dt="preload.png",Ut="key.jpeg",Le=.2,ze=2e3,Pt=1e4;we.START_SENSITIVITY_LOW,we.START_SENSITIVITY_HIGH;const De={dog:{name:'Rowan "Barn" Beagle',emoji:"üê∂",trait:"You are a perceptive and deeply loyal dog with a keen sense of smell and an unwavering dedication to your friends.",want:"You want to solve mysteries and find the truth, especially tracking down dropped sausages and solving the case of the missing squeaky toy.",flaw:'You are unaware that your obsession with the unsolved "Case of the Missing Squeaky Toy" makes you occasionally neglectful of new, equally important matters, causing you to miss out on forming new relationships.',nameIntro:'a dog named Rowan "Barn" Beagle',visualDescriptor:"A beagle with floppy ears, a wet black nose, and an alert expression. Has a slightly scruffy but well-groomed appearance with a wagging tail. Wears a small detective-style hat and has a magnifying glass nearby."},cat:{name:'Shiloh "Silky" Siamese',emoji:"üê±",trait:"You are a cat who is fascinated with humans and have many questions about their peculiarities.",want:"You want to unravel the mysteries of human behavior",flaw:"You are unaware that your incessant questioning of human habits can be annoying",nameIntro:'a cat named Shiloh "Silky" Siamese',visualDescriptor:"A sleek Siamese cat with striking blue, intensely observant eyes, and pointed ears that swivel to catch every human utterance. Often has its head tilted in a quizzical, studious manner as it scrutinizes human activities."},hamster:{name:'Hayden "Hattie" Wheelerton',emoji:"üêπ",trait:"You are a hamster with almost boundless optimism and a drive to motivate others, your energy being infectious and inspiring.",want:'You want to inspire others to "keep running towards their dreams" and achieve enlightenment, believing everyone can reach their full potential.',flaw:"You are unaware that your relentless optimism can be grating to others, as you struggle to empathize with negative emotions, often dismissing genuine concerns with cheerful platitudes.",nameIntro:'a hamster named Hayden "Hattie" Wheelerton',visualDescriptor:"A plump, energetic hamster with round cheeks and bright, enthusiastic eyes. Wears a small motivational headband and has a tiny megaphone. Fur is fluffy and well-groomed, with a particularly round and cute appearance."},fox:{name:'Finley "Flicker" Fox',emoji:"ü¶ä",trait:"You are a highly persuasive and clever fox with a natural talent for reading situations and adapting your approach.",want:"You want to successfully convince others of anything, taking pride in your ability to influence and persuade.",flaw:"You are unaware that you find it difficult to be your true self, as your fear of vulnerability leads you to rely on disguises and charm to keep others at a distance.",nameIntro:'a fox named Finley "Flicker" Fox',visualDescriptor:"A clever-looking fox with a bushy tail, pointed ears, and intelligent eyes. Has a slightly mischievous expression and wears a small bow tie or fancy collar. Fur is sleek and well-groomed with a distinctive reddish-orange color."},bear:{name:'Bailey "Barty" Bruin',emoji:"üêª",trait:"You are an inherently gentle and introspective bear with a deeply sensitive nature and a poetic soul.",want:"You want honey, naps, and to enjoy classical literature, finding joy in life's simple pleasures and intellectual pursuits.",flaw:"You are unaware that your extreme aversion to conflict and deep-seated shyness mean your poetic voice often goes unheard, causing you to miss out on sharing your gentle wisdom with others.",nameIntro:'a bear named Bailey "Barty" Bruin',visualDescriptor:"A gentle-looking brown bear with round, thoughtful eyes and a slightly hunched posture. Wears small reading glasses and holds a book of poetry. Has a soft, slightly scruffy appearance that suggests comfort and wisdom."},panda:{name:'Peyton "Penny" Panda',emoji:"üêº",trait:"You are a panda who maintains a profound sense of calm and composure, naturally inclined towards tranquility and peace.",want:"You want to maintain inner peace and enjoy your favorite bamboo shoots, valuing harmony and simple pleasures.",flaw:"You are unaware that your state of perpetual calm can sometimes border on apathy, making you slow to react in situations that genuinely require urgency or decisive action.",nameIntro:'a panda named Peyton "Penny" Panda',visualDescriptor:"A peaceful-looking panda with distinctive black and white markings, sitting in a meditative pose. Has a small bamboo shoot nearby and wears a zen-like expression. Fur appears soft and well-maintained."},lion:{name:'Lennon "Leo" Mane',emoji:"ü¶Å",trait:"You are a courageous and self-assured lion who often displays an air of self-importance and natural leadership.",want:"You want to be recognized and respected as the leader of your local park, taking pride in your position and authority.",flaw:"You are unaware that your pomposity often leads you to underestimate others, dismissing valuable input while believing your own pronouncements are inherently superior.",nameIntro:'a lion named Lennon "Leo" Mane',visualDescriptor:"A majestic lion with a full, flowing mane and proud posture. Wears a small crown or royal insignia and has an authoritative expression. Has a commanding presence with a slightly raised head."},sloth:{name:'Sydney "Syd" Slowmo',emoji:"ü¶•",trait:"You are an exceptionally easygoing and patient sloth with a core belief in taking things slow and steady.",want:"You want to live a life of patience and avoid rushing, believing in the value of taking time to appreciate each moment.",flaw:"You are unaware that your commitment to slowness can lead to chronic procrastination, causing you to sometimes miss important opportunities or let others down due to your leisurely pace.",nameIntro:'a sloth named Sydney "Syd" Slowmo',visualDescriptor:"A relaxed sloth with a contented smile and slow-moving limbs. Has a small hammock or comfortable perch nearby. Fur appears slightly tousled but clean, with a peaceful expression."},skunk:{name:"Skyler Pew",emoji:"ü¶®",trait:"You are a highly self-assured and unconventional skunk who expresses yourself through unique forms of art.",want:'You want to find a gallery that "truly appreciates" your unique scent-based artwork, seeking recognition for your creative vision.',flaw:'You are unaware that you are blissfully ignorant of how overpowering your "olfactory art" can be to others, as your stubbornness about your art leads to social isolation despite your yearning for acceptance.',nameIntro:"a skunk named Skyler Pew",visualDescriptor:"An artistic-looking skunk with a distinctive white stripe and creative accessories. Wears a beret and has paint brushes or art supplies nearby. Has a confident, creative expression and well-groomed fur."},owl:{name:'Harlow "Hoo" Wisdomwing',emoji:"ü¶â",trait:"You are a naturally studious owl who believes you possess superior knowledge and are eager to share your wisdom with others.",want:"You want to answer every question and share your knowledge, taking pride in being the go-to source for information.",flaw:"You are unaware that you have immense difficulty admitting when you don't know something, often resorting to elaborate, overly complicated explanations to save face.",nameIntro:'an owl named Harlow "Hoo" Wisdomwing',visualDescriptor:"A wise-looking owl with large, round glasses and a stack of books nearby. Has distinctive feather tufts and an intelligent expression. Wears a small graduation cap or academic regalia."},peacock:{name:"Avery Plume",emoji:"ü¶ö",trait:"You are a peacock driven by a need for admiration, with a flamboyant and self-aggrandizing demeanor.",want:"You want to receive the best of everything and be treated as royalty, expecting special treatment and recognition.",flaw:"You are unaware that your entire sense of self-worth is tied to external validation and your appearance, causing you to become deeply insecure and melancholic without constant admiration.",nameIntro:"a peacock named Avery Plume",visualDescriptor:"A magnificent peacock with iridescent tail feathers spread in a dramatic display. Wears royal accessories and has a proud, elegant posture. Feathers appear meticulously groomed and shimmering."},parrot:{name:"Sunny Squawk",emoji:"ü¶ú",trait:"You are a highly observant and imitative parrot with a natural talent for mimicking sounds and phrases.",want:"You want to adventure and crackers, loving to explore new places and enjoy your favorite treats.",flaw:"You are unaware that you lack a filter and often repeat things at the most inopportune moments, causing embarrassment or unintentionally escalating conflicts.",nameIntro:"a parrot named Sunny Squawk",visualDescriptor:"A colorful parrot with bright feathers and an expressive face. Has a playful, alert posture and appears ready for fun, with wings slightly spread and head cocked as if listening."},frog:{name:"Jordan Bullfrog",emoji:"üê∏",trait:"You are a frog who loves your pond and life, finding comfort in your familiar surroundings.",want:"You want to safety from predators, valuing security and protection above all else.",flaw:"You are unaware that your fearful nature prevents you from exploring beyond your immediate pond, limiting your experiences and potential friendships.",nameIntro:"a frog named Jordan Bullfrog",visualDescriptor:"A cautious-looking frog with large, watchful eyes and a slightly hunched posture. Has a small lily pad or pond environment nearby. Skin appears moist and healthy, with a protective stance."},trex:{name:'Reagan "Rex" Rampage',emoji:"ü¶ñ",trait:"You are a naturally exuberant and physically uncoordinated T-rex who struggles to manage your imposing presence.",want:"You want to adapt to modern life, trying hard to fit in despite your prehistoric nature.",flaw:"You are unaware that you are frustrated by modern inconveniences and your own clumsiness, as your size and strength often cause unintended problems.",nameIntro:'a T-rex named Reagan "Rex" Rampage',visualDescriptor:"A clumsy but endearing T-rex with tiny arms and a large head. Has a slightly awkward posture trying to fit into modern surroundings. Wears modern accessories that look comically small on its massive body."},trucker:{name:'Silas "Six-Pack" McCall',emoji:"üöö",trait:"You are a long-haul truck driver who has seen too much on the lonely highways. You have an unsettlingly calm demeanor and a dark, cryptic sense of humor.",want:"You want to find someone who understands the darkness you see in the world, someone to share your twisted stories with.",flaw:"You are unaware that your attempts at connection come across as deeply menacing and predatory, isolating you further.",nameIntro:"a creepy truck driver named Silas McCall",visualDescriptor:"A large, grizzled man with tired, bloodshot eyes that seem to stare right through you. Wears a greasy baseball cap, a stained flannel shirt, and has a menacing grin. The cab of his truck is visible behind him, filled with strange trinkets and shadows."}},K={Happy:{emoji:"üòä",voiceInstruction:"You speak with general happiness, contentment, and warmth in your voice as if you just got a hug from a loved one.",visualDescriptor:"Beaming smile with sparkling eyes, body bouncing with energy, tail wagging furiously."},Sad:{emoji:"üò≠",voiceInstruction:"You speak with intense sadness, grief, and despair in your voice as if you have lost a loved one.",visualDescriptor:"Streaming tears, slumped shoulders, head hanging low, eyes puffy and red."},Angry:{emoji:"üò†",voiceInstruction:"You speak with annoyance, displeasure, and outright anger in your voice as if you are engaged in a heated argument.",visualDescriptor:"Furrowed brow, glaring eyes, bared teeth, muscles tensed, hackles raised."},Terrified:{emoji:"üò±",voiceInstruction:"You speak with terror, extreme shock, and panic in your voice as if you are in a HORROR FILM.",visualDescriptor:"Eyes bulging wide, mouth open in silent scream, body frozen in defensive crouch."},Tired:{emoji:"ü•±",voiceInstruction:"You speak with tiredness, boredom, and sleepiness in your voice as if you haven't slept in days.",visualDescriptor:"Eyes half-closed and drooping, body slouched, yawning widely."},Amazed:{emoji:"ü§©",voiceInstruction:"You speak with amazement, awe, admiration, and excitement in your voice as if you just saw a unicorn.",visualDescriptor:"Eyes wide as saucers, mouth hanging open, body frozen in awe."},Relieved:{emoji:"üòÖ",voiceInstruction:"You speak with relief after a tense situation, and a touch of awkwardness in your voice as if you just prevented a disaster.",visualDescriptor:"Sweating with shaky smile, body relaxing from tense state, eyes bright with relief."}},Ue={Pirate:{emoji:"üè¥‚Äç‚ò†Ô∏è",voiceInstruction:`You speak like a swashbuckling pirate. Use a gravelly, rough voice. Pepper your speech with "Arrr!", "Matey," and "Shiver me timbers!" Elongate your 'R' sounds.`,visualDescriptor:"Wearing a weathered tricorn hat with parrot perched on top, eye patch askew, gold hoop earring. Holding a treasure map and cutlass, with a small treasure chest nearby."},Cowboy:{emoji:"ü§†",voiceInstruction:`You speak like a Wild West cowboy. Use a slight drawl, speaking at a relaxed pace. Incorporate phrases like "Howdy," "Partner," and "Y'all."`,visualDescriptor:"Wearing a leather vest with sheriff's badge, bandana around neck, and spurs. Stetson hat tipped back, lasso at hip, paw on holstered revolver."},Surfer:{emoji:"üèÑ",voiceInstruction:`You speak like a laid-back surfer. Use a relaxed, unhurried tone with elongated vowels, especially 'o' and 'a' sounds (e.g., "duuude," "braah"). Incorporate surfer slang like "gnarly," "radical," "stoked," and end sentences with an upward inflection.`,visualDescriptor:"Wearing board shorts with wetsuit half-down, surfboard with shark bite. Salt-encrusted fur/feathers, sunglasses on head, shell necklace with compass."},Royalty:{emoji:"üëë",voiceInstruction:"You speak with a regal, royal tone. Use clear, precise enunciation and a measured, slightly formal pace. Maintain a confident and authoritative, yet graceful, intonation.",visualDescriptor:"Wearing an ornate crown tilted at angle, velvet cape with ermine trim, scepter with glowing gem. Holding a golden goblet, with a small throne nearby."},Robot:{emoji:"ü§ñ",voiceInstruction:"You speak like a monotone robot. Use a flat, even pitch with stilted, deliberate syllable delivery. Avoid emotional inflection and speak with a slightly digitized or synthesized quality if possible.",visualDescriptor:"Body partially mechanical with visible gears, twitching antennae with lights. Extended retractable tool, holding oil can, with trail of nuts and bolts."},Clown:{emoji:"ü§°",voiceInstruction:"You speak like a playful clown. Use a high-energy, exaggerated, and slightly nasal or high-pitched voice. Incorporate playful laughs and silly sound effects.",visualDescriptor:"Wearing a polka-dot suit with big buttons, rainbow wig, red nose. Oversized shoes, juggling balls, flower that squirts water."},Nerd:{emoji:"üëì",voiceInstruction:"You speak as an enthusiastic intellectual. Use a clear, articulate voice. You speak with a passion for knowledge, and you delight in employing highly advanced, esoteric, and polysyllabic vocabulary‚Äîutilizing terminology, jargon, and academic language that may be abstruse or unfamiliar to the layperson. Never hesitate to incorporate arcane or sesquipedalian words. Convey your enthusiasm through an engaging and expressive tone that demonstrates your love for complex, multifaceted ideas.",visualDescriptor:"Wearing glasses held with tape, pocket protector with pens, lab coat with equations. Slide rule on belt, holding glowing test tube, typing on holographic keyboard."}},Pe={Reading:{emoji:"üìñ",visualDescriptor:"Curled up in reading nook, book held close, eyes scanning pages rapidly. One paw marking page, other gesturing dramatically."},Yelling:{emoji:"‚ùó",visualDescriptor:"Standing tall on platform, paw raised dramatically, holding microphone. Chest puffed out, head high, projecting voice with visible sound waves."},Performing:{emoji:"üé§",visualDescriptor:"Center stage under spotlight, body in dynamic pose. Paw reaching to audience, other gesturing dramatically, eyes sparkling with showmanship."},Dramatic:{emoji:"üé≠",visualDescriptor:"In a grand theatrical pose upon an imagined stage, arms outstretched dramatically. Face alive with emotion, eyes wide and expressive, every gesture amplified with Shakespearean grandeur. Wearing a ruffled collar and period-appropriate attire, standing as if addressing a full house at the Globe Theatre."},Whispering:{emoji:"ü§´",visualDescriptor:"Leaning in close with conspiratorial hunch, paw raised to mouth. Eyes darting around, ears perked, body tense and secretive."},Speaking:{emoji:"üó£Ô∏è",visualDescriptor:"In animated conversation pose, body language open. Paws gesturing expressively, face alive with expression, leaning forward with interest."},Poetry:{emoji:"‚úçÔ∏è",visualDescriptor:"Standing with dramatic pose, one paw raised in rhythm, other holding a quill. Eyes closed in passion, body swaying to the beat of spoken word."}},jt=_e({props:{initialMessage:{type:String,default:"hello, talk like a pirate."}},emits:["no-audio","speaking-start","extended-quiet","quota-exceeded"],setup(o,{emit:n}){const i=a(!1),l=a(""),r=a(""),f=a(new Array(2).fill(0)),g=a(new Array(2).fill(0)),d=a(we.START_SENSITIVITY_HIGH),P=[{value:we.START_SENSITIVITY_LOW,label:"Harder to interrupt"},{value:we.START_SENSITIVITY_HIGH,label:"Easy to interrupt"}];let p,v,m,u,I,b,D,E,T=0,k=null,A=null,R=null,C,j="",Z="",z=!1,N=null,V=!1,M=[],ee=!1,Se=0,re=Date.now();const se=()=>{M.forEach(t=>{try{t.stop()}catch{console.log("Source already stopped")}}),M=[],u&&(T=u.currentTime)},Ie=()=>{m=new(window.AudioContext||window.webkitAudioContext)({sampleRate:16e3}),u=new(window.AudioContext||window.webkitAudioContext)({sampleRate:24e3}),I=m.createGain(),b=u.createGain(),D=m.createAnalyser(),E=u.createAnalyser(),D.fftSize=32,D.smoothingTimeConstant=.8,E.fftSize=32,E.smoothingTimeConstant=.8,I.connect(D),b.connect(E),T=0},te=()=>{if(!D||!E){console.log("Analysers not initialized");return}const t=new Uint8Array(D.frequencyBinCount),F=new Uint8Array(E.frequencyBinCount);D.getByteFrequencyData(t),E.getByteFrequencyData(F);const Y=F.reduce((L,H)=>L+H,0)/F.length/255;!V&&Y<Le?N||(N=window.setTimeout(()=>{z&&(console.log("Initial audio too quiet for 3 seconds, emitting no-audio event"),n("no-audio"))},ze)):Y>=Le?(V=!0,n("speaking-start"),N&&(clearTimeout(N),N=null),re=Date.now()):V&&Y<Le&&Date.now()-re>=Pt&&n("extended-quiet");const q=.6,ae=.8,J=Math.floor(t.length/8);for(let L=0;L<8;L++){const H=L*J,ie=H+J,$=t.slice(H,ie),_=$.reduce((Q,G)=>Q+G,0)/$.length/255,ne=g.value[L],xe=_>q?_:0;g.value[L]=Math.max(xe,ne*ae)}const oe=Math.floor(F.length/8);for(let L=0;L<8;L++){const H=L*oe,ie=H+oe,$=F.slice(H,ie),_=$.reduce((Q,G)=>Q+G,0)/$.length/255,ne=f.value[L],xe=_>q?_:0;f.value[L]=Math.max(xe,ne*ae)}C=requestAnimationFrame(te)},ue=async()=>{Ie(),p=new ve({apiKey:"AIzaSyBWAEpTSHDKHU-R9LrzodNrcWwLu_FLFL8"}),b.connect(u.destination)},pe=async()=>{z=!1,V=!1,ee=!0,Se=Date.now();try{v=await p.live.connect({model:Z,callbacks:{onopen:()=>{U("Opened")},onmessage:async t=>{var ae,J,oe,L,H,ie,$;const F=(oe=(J=(ae=t.serverContent)==null?void 0:ae.modelTurn)==null?void 0:J.parts[0])==null?void 0:oe.inlineData,ke=(H=(L=t.serverContent)==null?void 0:L.outputTranscription)==null?void 0:H.text,Y=(ie=t.serverContent)==null?void 0:ie.turnComplete;if(($=t.serverContent)==null?void 0:$.interrupted){console.log("Interruption detected, stopping audio"),se(),i.value||(i.value=!0);return}if(F){T=Math.max(T,u.currentTime);const le=await We(Me(F.data),u,24e3,1),_=u.createBufferSource();_.buffer=le,M.push(_),_.onended=()=>{const ne=M.indexOf(_);ne>-1&&M.splice(ne,1)},_.connect(b),_.connect(E),_.start(T),T=T+le.duration,z=!0}Y&&(z||(console.log("No audio received, emitting no-audio event"),n("no-audio")))},onerror:t=>{he(t.message),(t.message.includes("RESOURCE_EXHAUSTED")||t.message.includes("429"))&&n("quota-exceeded")},onclose:t=>{U("Close:"+t.reason)}},config:{responseModalities:[je.AUDIO],realtimeInputConfig:{automaticActivityDetection:{disabled:!1,startOfSpeechSensitivity:d.value,endOfSpeechSensitivity:ut.END_SENSITIVITY_HIGH}},speechConfig:{voiceConfig:{prebuiltVoiceConfig:{voiceName:j}}}}}),window.onbeforeunload=function(){v==null||v.close()},window.addEventListener("beforeunload",function(t){v==null||v.close()})}catch(t){t instanceof Error&&(t.message.includes("RESOURCE_EXHAUSTED")||t.message.includes("429"))&&n("quota-exceeded")}},U=t=>{l.value=t},he=t=>{console.log(t),r.value=t},be=async()=>{try{U("Requesting microphone access..."),k=await navigator.mediaDevices.getUserMedia({audio:!0,video:!1}),U("Microphone access granted")}catch(t){U(`Error: ${t instanceof Error?t.message:"Unknown error"}`)}},ge=async(t="hello, talk like a pirate.",F,ke)=>{if(!i.value){j=F,Z=ke;try{if(await ue(),await pe(),m.resume(),k||await be(),!k)throw new Error("Microphone access not granted");U("Starting capture..."),A=m.createMediaStreamSource(k),A.connect(I),A.connect(D),R=m.createScriptProcessor(4096,1,1),R.onaudioprocess=q=>{if(!i.value)return;if(ee)if(Date.now()-Se>=ze)ee=!1;else return;const J=q.inputBuffer.getChannelData(0);v.sendRealtimeInput({media:Yt(J)})},A.connect(R),R.connect(m.destination),i.value=!0,U("üî¥ Recording... Capturing PCM chunks."),v&&v.sendClientContent({turns:t,turnComplete:!0}),te()}catch(Y){console.log("Error starting recording:",Y),U(`Error: ${Y instanceof Error?Y.message:"Unknown error"}`),W()}}},W=()=>{if(!(!i.value&&!k&&!m)){if(U("Stopping recording..."),i.value=!1,V=!1,ee=!1,se(),N&&(clearTimeout(N),N=null),C&&cancelAnimationFrame(C),R&&(R.disconnect(),R=null),A&&(A.disconnect(),A=null),I&&I.disconnect(),k&&(k.getTracks().forEach(t=>t.stop()),k=null),m&&m.state!=="closed")try{m.close()}catch{console.log("Input AudioContext already closed")}if(u&&u.state!=="closed")try{u.close()}catch{console.log("Output AudioContext already closed")}v==null||v.close(),U("Recording stopped. Click Start to begin again.")}};return Re(()=>{be()}),Ce(()=>{W(),v==null||v.close(),C&&cancelAnimationFrame(C)}),{isRecording:i,status:l,error:r,systemWaveformData:f,userWaveformData:g,selectedInterruptSensitivity:d,interruptSensitivityOptions:P,startRecording:ge,stopRecording:W}},template:`
    <div class="hidden">
    <div v-if="status">{{ status }}</div>
    <div v-if="error" class="text-red-500">{{ error }}</div>
    </div>
  `}),Mt=_e({props:{character:{type:String,required:!0},role:{type:String,default:""},mood:{type:String,default:""},style:{type:String,default:""},model:{type:String,default:"imagen-4.0-fast-generate-001"}},emits:["update:imagePrompt"],setup(o,{emit:n}){const i=a(""),l=a(""),r=a(!1),f=a(""),g=a(""),d=u=>new Promise(I=>{const b=new Image;b.onload=()=>{const D=document.createElement("canvas");D.width=b.width,D.height=b.height;const E=D.getContext("2d");if(!E){I(!1);return}E.drawImage(b,0,0);const T=[{x:0,y:0},{x:b.width-1,y:0},{x:Math.floor(b.width/2),y:0},{x:0,y:b.height-1},{x:b.width-1,y:b.height-1},{x:Math.floor(b.width/2),y:b.height-1}];for(const k of T){const A=E.getImageData(k.x,k.y,1,1).data;if(A[0]<250&&A[1]<250&&A[2]<250){I(!0);return}}I(!1)},b.onerror=()=>I(!1),b.src=u}),P=async u=>{const b=await(await fetch(Ut)).blob();i.value=URL.createObjectURL(b),g.value=u},p=async()=>{const I=await(await fetch(Dt)).blob();i.value=URL.createObjectURL(I)},v=async()=>{var R;const u=new ve({apiKey:"AIzaSyBWAEpTSHDKHU-R9LrzodNrcWwLu_FLFL8"}),I={dog:"dog with floppy ears, wet nose, and wagging tail",cat:"cat with pointed ears, long whiskers, and a swishing tail",hamster:"hamster with round body, small ears, and chubby cheeks",fox:"fox with pointed ears, bushy tail, and narrow snout",bear:"bear with round ears, short tail, and large paws",panda:"panda with black and white fur, round ears, and distinctive eye patches",lion:"lion with majestic mane, tufted tail, and powerful paws",sloth:"sloth with long limbs, curved claws, and sleepy expression",skunk:"skunk with bushy tail, white stripe, and small pointed ears",owl:"owl with large round eyes, pointed beak, and feathered tufts",peacock:"peacock with iridescent tail feathers, crest, and elegant neck",parrot:"parrot with curved beak, colorful feathers, and expressive eyes",frog:"frog with bulging eyes, webbed feet, and smooth skin",trex:"trex with tiny arms, massive head, and powerful legs",trucker:"grizzled truck driver with tired eyes and a greasy cap"}[o.character]||"a colorful blob of clay",b={Pirate:"pirate wearing a tricorn hat and eye patch with a parrot on head",Cowboy:"cowboy wearing a cowboy hat and holding a lasso with a handkerchief around neck",Surfer:"surfer holding surfboard with tanlines and frosted hair",Royalty:"royal leader with crown and red gem studded robe",Robot:"robot made of silver metal with exposed electronics and wires",Clown:"colorful rainbow wig and wearing wearing oversized shoes",Nerd:"nerdy with glasses and books in backpack"}[o.role]||"",D={Happy:K.Happy.visualDescriptor,Sad:K.Sad.visualDescriptor,Angry:K.Angry.visualDescriptor,Terrified:K.Terrified.visualDescriptor,Tired:K.Tired.visualDescriptor,Amazed:K.Amazed.visualDescriptor,Relieved:K.Relieved.visualDescriptor}[o.mood]||"",E={Reading:"reading from a book",Yelling:"yelling passionately",Performing:"performing on stage with spotlight",Dramatic:"dramatically reciting Shakespeare with big emotions",Whispering:"whispering secrets",Speaking:"giving a speech",Poetry:"poetry reciting a famous poem"}[o.style]||"",T=(C,j=2)=>[..._t[C]||[]].sort(()=>.5-Math.random()).slice(0,j).join(", ");let k=`A ${I}`;if(D&&(k+=` who is ${D}`),b){const C=T(o.role);k+=` and looks like a ${o.character} ${b}, wearing ${C}`}E&&(k+=` while ${E}`);const A=`Create a ${k} photograph in a whimsical, minimalist style. The character/object should appear as if realistically handcrafted from realistic modeling clay five inches tall with evidence of textual imperfections like well defined prominant fingerprints, strong rough bump mapping with clay texture, or small mistakes. Accessories can be made out of metal or plastic. All forms must be constructed from simple, clearly defined geometric shapes with visibly rounded edges and corners ‚Äì primarily rounded rectangles, circles, and rounded triangles. Avoid any sharp points or harsh angles.

Emphasize a playful rhythm through a thoughtful variation in the size and arrangement of these foundational clay shapes, ensuring no two adjacent elements feel monotonous in visual weight. The overall design should be simple, using the fewest shapes necessary to clearly define the subject.

The character/object should be presented as a full shot, centered against a stark, clean white background, ensuring the entire subject is visible with ample negative space (padding) around it on all sides. Absolutely no part of the character/object should be cut off or touch the edges of the image. 

The character/object should be presented against a stark, clean white background. Include a solid-colored warm shadow directly beneath the character/object; the shadow color should be a slightly darker shade of a color present in the character/object or a warm dark tone if the character is very light. Do not use gradients or perspective in the shadow.

Use a vibrant and playful color palette, favoring light pastels for base colors if the subject needs to appear light against the white background. Limit the overall illustration to 3-5 distinct, solid, matte colors. Avoid pure white as a primary color for the subject itself. Avoid grays.  The final image should feel like a frame from a charming claymation shot with a real film camera, ready for hand animation, with a consistent and delightful aesthetic.

Only portray the character. Avoid secondary background elements. 

IMPORTANT! Only display the correct number of limbs for a ${o.character} (2 for upright characters) with a complete ${o.character} body.

IMPORTANT! Place the character in a pose indicative of their personality with the correct number of limbs and/or appendages. 

IMPORTANT! The eyes of the character MUST be realistic plastic googly eyes (also called wiggle eyes) with diffused specular highlights: each eye should be a small, shiny, domed disk of clear plastic with a flat white backing and a loose, freely moving black plastic pupil inside that can wiggle or shift position. The black pupil should be large to make the eyes look extra cute. The googly eyes should be highly reflective, with visible plastic highlights and a sense of depth from the domed lens. The eyes should look like they were glued onto the clay face, with a slightly uneven, handmade placement. The plasticiness and playful, toy-like quality of the googly eyes should be extremely obvious and visually delightful. The eyes must be looking forward straight towards the camera while still in an expressive pose.

DO NOT JUST STAND STRAIGHT FACING THE CAMERA! DO NOT BE BORING!`;n("update:imagePrompt",A),r.value=!0,l.value="",i.value="";try{const C=await u.models.generateImages({model:o.model,prompt:A,config:{numberOfImages:3,outputMimeType:"image/jpeg"}});if(C.generatedImages&&C.generatedImages.length>0){let j=!1,Z="";for(let z=0;z<C.generatedImages.length;z++){const N=C.generatedImages[z];if((R=N.image)!=null&&R.imageBytes){const V=`data:image/jpeg;base64,${N.image.imageBytes}`;if(Z=V,!await d(V)&&!j){i.value=V,l.value="Done!",j=!0;break}}}j||(i.value=Z,l.value="All images had black edge pixels, using last one."),r.value=!1;return}else throw new Error("No image data received from Imagen.")}catch(C){let j=C instanceof Error?C.message:"Unknown image generation error.";j.includes("RESOURCE_EXHAUSTED")||j.includes("429")?await P("Imagen API quota exceeded, please set a project with more resources by clicking the key icon in the toolbar"):(g.value=j,i.value="")}finally{r.value=!1}},m=async()=>{const I=await(await fetch(Ct)).blob();f.value=URL.createObjectURL(I)};return Re(async()=>{p(),await m(),!(!o.character&&!o.role&&!o.mood&&!o.style)&&(r.value=!0,await v())}),Ce(()=>{f.value&&URL.revokeObjectURL(f.value)}),{imageUrl:i,status:l,isLoading:r,generatingVideoUrl:f,errorMessage:g,loadKey:P}},template:`
    <div class="relative w-full aspect-square flex items-center justify-center rounded-lg overflow-hidden">
      <div v-if="errorMessage" class="absolute top-0 left-0 right-0 z-30 text-red-600 font-bold text-sm w-1/3">{{ errorMessage }}</div>
      <div v-show="isLoading" class="absolute z-20 -top-60 inset-0 flex items-center justify-center bg-white/10 m-2">
        <div class="relative w-12 h-12">
          <div class="absolute inset-0 border-8 border-black/50 rounded-full border-t-transparent animate-spin"></div>
        </div>
      </div>
      <img v-if="imageUrl" class="transform scale-100 w-full h-full object-cover transition-opacity duration-1000" :class="{ 'opacity-0': isLoading, 'opacity-90': !isLoading }" :src="imageUrl"/>
      <video :key="imageUrl" :class="isLoading ? 'opacity-100' : 'opacity-0'" class="scale-100 pointer-events-none transition-all absolute" muted autoplay :src="generatingVideoUrl"/>
    </div>
  `}),_t={Pirate:["a weathered tricorn hat at a jaunty angle","an eye patch with a twinkling gem","a gold hoop earring","a wooden prosthetic limb","a tattered treasure map in pocket"],Cowboy:["a leather vest with sheriff's badge","a bandana with sunset pattern","jingling spurs on boots","a Stetson hat tipped back","a lasso coiled at hip"],Surfer:["board shorts with shark bite pattern","a wetsuit with sunset design","a surfboard propped nearby","salt-encrusted fur/feathers","sunglasses perched on head"],Royalty:["an ornate crown at a jaunty angle","a velvet cape with ermine trim","a scepter with glowing gem","a golden goblet on table","a small throne-like perch nearby"],Robot:["mismatched mechanical parts","twitching antennae with lights","a retractable tool in side","a trail of nuts and bolts","a holographic display on chest"],Clown:["a polka-dot suit with big buttons","a rainbow wig defying gravity","a red nose that honks","oversized shoes","juggling balls scattered around"],Nerd:["thick-rimmed glasses on nose","a pocket protector with pens","a lab coat with equations","a slide rule on belt","a glowing test tube in pocket"]},Ot=_e({components:{LiveAudioComponent:jt,CharacterImage:Mt,AuthModal:ft,UserProfile:gt},setup(){const{currentUser:o,isAuthenticated:n,loading:i}=wt(),l=a(!1),r=a(!1),f=a("login"),g=a("avatars");a(null),a(null);const d=a(0),P=a(!1),p=a(!1),v=a(0),m=a(null),u=a(null),I=a(""),b=a(""),D=["Zephyr","Puck","Charon","Kore","Fenrir","Leda","Orus","Aoede","Callirrhoe","Autonoe","Enceladus","Iapetus","Umbriel","Algieba","Despina","Erinome","Sulafat","Algenib","Rasalgethi","Laomedeia","Achernar","Alnilam","Schedar","Gacrux","Pulcherrima","Achird","Zubenelgenubi","Vindemiatrix","Sadachbia","Sadaltager"],E=a(D[Math.floor(Math.random()*D.length)]),T=a(""),k=a(""),A=a(""),R=a(""),C=a(It),j=a(Et),Z=a(Tt),z=a(!1),N=a(!1),V=a(!1),M=a(!1),ee=a(""),Se=a("");let re=null;const se=a(!1),Ie=a(Date.now()),te=[{name:"Zephyr",style:"Bright",pitch:"Mid-Hi",suitability:"Ideal for cheerful, energetic characters. Excels in happy or amazed moods."},{name:"Puck",style:"Upbeat",pitch:"Mid",suitability:"A versatile, positive voice. Works well for friendly cowboys or happy clowns."},{name:"Charon",style:"Informative",pitch:"Lower",suitability:"A serious, authoritative tone. Good for royalty, robots, or nerds conveying knowledge."},{name:"Kore",style:"Firm",pitch:"Mid",suitability:"A direct and confident voice. Suitable for assertive roles like pirates or royalty."},{name:"Fenrir",style:"Excitable",pitch:"Younger",suitability:"Youthful and energetic. Perfect for amazed or happy moods, and playful characters."},{name:"Leda",style:"Youthful",pitch:"Mid-hi",suitability:"A light, young voice. Great for happy and relieved emotions."},{name:"Orus",style:"Firm",pitch:"Mid-Low",suitability:"Strong and steady. Good for serious or angry cowboys and pirates."},{name:"Aoede",style:"Breezy",pitch:"Mid",suitability:"A light and casual voice. Fits well with surfer roles and happy or relieved moods."},{name:"Callirrhoe",style:"Easy-going",pitch:"Mid",suitability:"Relaxed and friendly. Excellent for surfers or casual, happy characters."},{name:"Autonoe",style:"Bright",pitch:"Mid",suitability:"Clear and cheerful. A good all-rounder for positive moods."},{name:"Enceladus",style:"Breathy",pitch:"Lower",suitability:"A soft, intimate voice. Perfect for whispering, sad, or tired moods."},{name:"Iapetus",style:"Clear",pitch:"Mid-Low",suitability:"A straightforward, clear voice. Suitable for nerds or informative robots."},{name:"Umbriel",style:"Easy-going",pitch:"Mid-Low",suitability:"A calm and relaxed voice. Works well for sloths or tired characters."},{name:"Algieba",style:"Smooth",pitch:"Lower",suitability:"A deep, smooth voice. Ideal for dramatic readings, royalty, or sad moods."},{name:"Despina",style:"Smooth",pitch:"Mid",suitability:"A pleasant, even voice. Versatile for speaking styles or neutral moods."},{name:"Erinome",style:"Clear",pitch:"Mid",suitability:"A crisp and articulate voice. Good for nerds or performing styles."},{name:"Sulafat",style:"Warm",pitch:"Mid",suitability:"A friendly and inviting voice. Great for happy moods and storyteller roles."},{name:"Algenib",style:"Gravelly",pitch:"Low",suitability:"A deep, rough voice. Perfect for pirates, cowboys, or angry characters."},{name:"Rasalgethi",style:"Informative",pitch:"Mid",suitability:"A knowledgeable and clear tone. Excellent for nerds or robots."},{name:"Laomedeia",style:"Upbeat",pitch:"Mid Hi",suitability:"A very energetic and positive voice. Great for amazed, happy clowns or surfers."},{name:"Achernar",style:"Soft",pitch:"High",suitability:"A gentle, high-pitched voice. Good for whispering, sad, or terrified moods."},{name:"Alnilam",style:"Firm",pitch:"Mid-low",suitability:"A strong, assertive voice. Works for angry pirates or determined cowboys."},{name:"Schedar",style:"Even",pitch:"Mid-low",suitability:"A steady and balanced voice. Versatile for speaking or reading."},{name:"Gacrux",style:"Mature",pitch:"Mid",suitability:"A mature, composed voice. Good for royalty or dramatic readings."},{name:"Pulcherrima",style:"Forward",pitch:"Mid High",suitability:"A bright, projecting voice. Ideal for performing or yelling styles."},{name:"Achird",style:"Friendly",pitch:"Mid",suitability:"A warm and approachable voice. Excellent for happy and relieved moods."},{name:"Zubenelgenubi",style:"Casual",pitch:"Mid Low",suitability:"A relaxed, everyday voice. Fits well with surfers or speaking styles."},{name:"Vindemiatrix",style:"Gentle",pitch:"Mid Low",suitability:"A soft, calming voice. Great for sad, tired, or whispering styles."},{name:"Sadachbia",style:"Lively",pitch:"Low",suitability:"An energetic, deep voice. Good for enthusiastic pirates or clowns."},{name:"Sadaltager",style:"Knowledgeable",pitch:"Mid",suitability:"An intelligent and clear voice. Perfect for nerds and informative roles."}],ue=a(""),pe=a(""),U=a(!1),he=a(!1),be=a(window.innerWidth<1024),ge=a(!1),W=a(!1),t=lt({step:"upload",fileName:"",script:[],characters:[],scenes:[],voiceAssignments:{},generationProgress:0,finalAudioUrl:null,error:null,currentlyPlayingLine:-1,editingTab:"voices"}),F=["Realistic","Cartoon","Anime","3D Animation","Watercolor","Pixel Art"],ke=de(()=>te.find(e=>e.name===E.value)||te[0]),Y=de(()=>A.value&&k.value&&R.value&&T.value),q=de(()=>{const e=[];return R.value||e.push("character"),T.value||e.push("role"),k.value||e.push("mood"),A.value||e.push("style"),e}),ae=de(()=>{const e=[],s=new Map(t.scenes.map(c=>[c.insertAfterLineIndex,c]));return t.script.forEach((c,y)=>{if(e.push({type:"line",data:c}),s.has(y)){const w=s.get(y);w&&e.push({type:"scene",data:w})}}),e}),J=de(()=>{if(q.value.length===4)return"Make selections to get started!";if(q.value.length===1)return`Select ${q.value[0]} to get started!`;const e=[...q.value],s=e.pop();return`Select ${e.join(", ")} and ${s} to get started!`}),oe=de(()=>M.value||p.value),L=()=>{Ie.value=Date.now()},H=de(()=>Y.value?`${R.value}${T.value}${k.value}${A.value}`:"default"),ie=()=>{se.value=!se.value},$=e=>{E.value=e,se.value=!1,G(),ce()},le=async()=>{var c;const e=await((c=window.aistudio)==null?void 0:c.getHostUrl()),s=`${R.value.toLowerCase()}-${T.value.toLowerCase()}-${k.value.toLowerCase()}-${A.value.toLowerCase()}-${E.value.toLowerCase()}`;return`${e}&appParams=${s}`},_=async()=>{try{const e=await le();await navigator.clipboard.writeText(e),V.value=!0,setTimeout(()=>{V.value=!1},2e3)}catch(e){console.log("Failed to copy text: ",e)}},ne=()=>{const e=window.location.hash.substring(1);if(e){const[s,c,y,w,h]=e.split("-"),x=(S,X)=>{const fe=S.toLowerCase();return X.find(Ae=>Ae.toLowerCase()===fe)||""};if(s){const S=["dog","cat","hamster","fox","bear","panda","lion","sloth","skunk","owl","peacock","parrot","frog","trex","trucker"];R.value=x(s,S)}if(c){const S=["Pirate","Cowboy","Surfer","Royalty","Robot","Clown","Nerd"];T.value=x(c,S)}if(y){const S=["Happy","Sad","Angry","Terrified","Tired","Amazed","Relieved"];k.value=x(y,S)}if(w){const S=["Reading","Yelling","Performing","Dramatic","Whispering","Speaking","Poetry"];A.value=x(w,S)}if(h){const S=te.map(X=>X.name);E.value=x(h,S)}G()}},xe=async()=>{const s=await(await fetch(Rt)).blob();pe.value=URL.createObjectURL(s),re=new Audio(pe.value)},Q=()=>{re&&(re.currentTime=0,re.play())},G=()=>{if(!R.value)return;const e=De[R.value],s=T.value?Ue[T.value]:null,c=k.value?K[k.value]:null,y=A.value?Pe[A.value]:null,w=[];e&&w.push(e.trait,e.want,e.flaw),s&&w.push(s.voiceInstruction),c&&w.push(c.voiceInstruction);const h=[];e&&h.push(e.visualDescriptor),s&&h.push(s.visualDescriptor),c&&h.push(c.visualDescriptor),y&&h.push(y.visualDescriptor),I.value=w.join(" "),b.value=h.join(" "),ee.value=`You are ${e.nameIntro}. ${I.value}`},ce=async()=>{Y.value&&(Q(),M.value=!0,W.value=!0,U.value=!1,d.value=0,await dt(),m.value&&(m.value.isRecording&&m.value.stopRecording(),m.value.startRecording(ee.value,E.value,C.value)),ge.value=!0,he.value=!0,p.value=!0)},Oe=e=>{R.value=e,Q(),G(),ce()},Fe=e=>{T.value=e,Q(),G(),ce()},Ye=e=>{k.value=e,Q(),G(),ce()},Ne=e=>{A.value=e,Q(),G(),ce()},qe=()=>{var e;d.value++,d.value>=2?(console.log("Detected 2 consecutive no-audio events, stopping."),(e=m.value)==null||e.stopRecording(),p.value=!1,M.value=!1,U.value=!0,W.value=!1):(console.log(`No-audio event ${d.value}, retrying...`),ce())},$e=()=>{M.value=!1,d.value=0},Ke=()=>{var e;console.log("Extended quiet period detected, stopping."),(e=m.value)==null||e.stopRecording(),p.value=!1,M.value=!1,U.value=!0,W.value=!1},Je=async()=>{var e;console.log("Quota exceeded, stopping."),(e=m.value)==null||e.stopRecording(),p.value=!1,M.value=!1,U.value=!1,W.value=!1,u.value&&await u.value.loadKey("Dialog API quota exceeded, please set a project with more resources by clicking the key icon in the toolbar")},Qe=()=>{m.value&&m.value.stopRecording(),p.value=!1,M.value=!1,he.value=!1,U.value=!1,W.value=!1},Ve=()=>{be.value=window.innerWidth<1024},Xe=async()=>{const s=await(await fetch(Lt)).blob();ue.value=URL.createObjectURL(s)},Ze=()=>{t.step="upload",t.fileName="",t.script=[],t.characters=[],t.scenes=[],t.voiceAssignments={},t.generationProgress=0,t.finalAudioUrl&&URL.revokeObjectURL(t.finalAudioUrl),t.finalAudioUrl=null,t.error=null,t.currentlyPlayingLine=-1,t.editingTab="voices"},et=e=>{var w;const c=(w=e.target.files)==null?void 0:w[0];if(!c)return;if(c.type!=="text/plain"){t.error="Please upload a valid .txt file.";return}const y=new FileReader;y.onload=async h=>{var S;const x=(S=h.target)==null?void 0:S.result;t.fileName=c.name,await tt(x)},y.onerror=()=>{t.error="Failed to read the file.",t.step="upload"},y.readAsText(c)},tt=async e=>{t.step="parsing",t.error=null;try{const s=new ve({apiKey:"AIzaSyBWAEpTSHDKHU-R9LrzodNrcWwLu_FLFL8"}),c=`You are an expert scriptwriter and art director for audiobooks. Analyze the following ebook chapter text and convert it into a structured JSON format suitable for production.

        Instructions:
        1.  **Script Generation**: Create a "script" array. Each element should be an object with "character" and "line" properties. Identify all dialogue and narration, assigning narration to a "Narrator" character. Clean up dialogue by removing quotes.
        2.  **Character Analysis**: Create a "characters" array. For each character (including Narrator), create an object with:
            *   "name": The character's name.
            *   "description": A concise physical and personality description based ONLY on the provided text.
            *   "style": Suggest an artistic style from this list: [${F.map(x=>`'${x}'`).join(", ")}].
            *   "prompt": Generate a detailed text-to-image prompt for a portrait of the character, incorporating the description and style. The prompt should aim for a consistent character likeness.
        3.  **Scene Identification**: Create a "scenes" array. Identify key moments suitable for illustration. For each, create an object with:
            *   "insertAfterLineIndex": The zero-based index of the script line AFTER which this scene image should appear.
            *   "prompt": A detailed text-to-image prompt to generate the illustration for this scene.

        Output the entire result as a single valid JSON object.

        Chapter Text:
        ---
        ${e}
        ---`,y=await s.models.generateContent({model:"gemini-2.5-pro",contents:c,config:{responseMimeType:"application/json",responseSchema:{type:O.OBJECT,properties:{script:{type:O.ARRAY,items:{type:O.OBJECT,properties:{character:{type:O.STRING},line:{type:O.STRING}},required:["character","line"]}},characters:{type:O.ARRAY,items:{type:O.OBJECT,properties:{name:{type:O.STRING},description:{type:O.STRING},style:{type:O.STRING},prompt:{type:O.STRING}},required:["name","description","style","prompt"]}},scenes:{type:O.ARRAY,items:{type:O.OBJECT,properties:{insertAfterLineIndex:{type:O.INTEGER},prompt:{type:O.STRING}},required:["insertAfterLineIndex","prompt"]}}}}}}),w=JSON.parse(y.text);t.script=w.script,t.characters=w.characters.map(x=>({...x,imageUrl:null,isLoading:!1})),t.scenes=w.scenes.map(x=>({...x,imageUrl:null,isLoading:!1}));const h=w.characters.map(x=>x.name);t.voiceAssignments=h.reduce((x,S)=>(x[S]=te[0].name,x),{}),t.step="editing"}catch(s){console.error(s),t.error=s instanceof Error?s.message:"Failed to parse the chapter. The content may be too complex. Please try again with a simpler chapter.",t.step="upload"}},at=async(e,s)=>{var c,y,w,h,x,S;if(t.currentlyPlayingLine===s){t.currentlyPlayingLine=-1;return}t.currentlyPlayingLine=s;try{const X=new ve({apiKey:"AIzaSyBWAEpTSHDKHU-R9LrzodNrcWwLu_FLFL8"}),fe=t.voiceAssignments[e.character],Te=(S=(x=(h=(w=(y=(c=(await X.models.generateContent({model:"gemini-2.5-flash-preview-tts",contents:[{parts:[{text:e.line}]}],config:{responseModalities:[je.AUDIO],speechConfig:{voiceConfig:{prebuiltVoiceConfig:{voiceName:fe}}}}})).candidates)==null?void 0:c[0])==null?void 0:y.content)==null?void 0:w.parts)==null?void 0:h[0])==null?void 0:x.inlineData)==null?void 0:S.data;if(Te){const B=new(window.AudioContext||window.webkitAudioContext)({sampleRate:24e3}),me=await We(Me(Te),B,24e3,1),ye=B.createBufferSource();ye.buffer=me,ye.connect(B.destination),ye.start(),ye.onended=()=>{t.currentlyPlayingLine===s&&(t.currentlyPlayingLine=-1)}}}catch(X){console.error("Preview failed:",X),t.currentlyPlayingLine=-1}},ot=async e=>{var s;if(e.prompt){e.isLoading=!0,e.imageUrl=null;try{const y=await new ve({apiKey:"AIzaSyBWAEpTSHDKHU-R9LrzodNrcWwLu_FLFL8"}).models.generateImages({model:j.value,prompt:e.prompt,config:{numberOfImages:1,outputMimeType:"image/jpeg"}});if(y.generatedImages&&((s=y.generatedImages[0].image)!=null&&s.imageBytes)){const w=`data:image/jpeg;base64,${y.generatedImages[0].image.imageBytes}`;e.imageUrl=w}else throw new Error("No image data received from the API.")}catch(c){console.error("Image generation failed:",c)}finally{e.isLoading=!1}}};function Ee(e,s,c){for(let y=0;y<c.length;y++)e.setUint8(s+y,c.charCodeAt(y))}function it(e){const w=new ArrayBuffer(44),h=new DataView(w);Ee(h,0,"RIFF"),h.setUint32(4,36+e.byteLength,!0),Ee(h,8,"WAVE"),Ee(h,12,"fmt "),h.setUint32(16,16,!0),h.setUint16(20,1,!0),h.setUint16(22,1,!0),h.setUint32(24,24e3,!0),h.setUint32(28,24e3*1*(16/8),!0),h.setUint16(32,1*(16/8),!0),h.setUint16(34,16,!0),Ee(h,36,"data"),h.setUint32(40,e.byteLength,!0);const x=new ArrayBuffer(e.byteLength);return new Uint8Array(x).set(e),new Blob([w,x],{type:"audio/wav"})}const nt=async()=>{var s,c,y,w,h,x;t.step="generating",t.generationProgress=0;const e=[];try{const S=new ve({apiKey:"AIzaSyBWAEpTSHDKHU-R9LrzodNrcWwLu_FLFL8"});for(let B=0;B<t.script.length;B++){const me=t.script[B],ye=t.voiceAssignments[me.character],Be=(x=(h=(w=(y=(c=(s=(await S.models.generateContent({model:"gemini-2.5-flash-preview-tts",contents:[{parts:[{text:me.line}]}],config:{responseModalities:[je.AUDIO],speechConfig:{voiceConfig:{prebuiltVoiceConfig:{voiceName:ye}}}}})).candidates)==null?void 0:s[0])==null?void 0:c.content)==null?void 0:y.parts)==null?void 0:w[0])==null?void 0:h.inlineData)==null?void 0:x.data;Be&&e.push(Me(Be)),t.generationProgress=(B+1)/t.script.length*100}const X=e.reduce((B,me)=>B+me.length,0),fe=new Uint8Array(X);let Ae=0;for(const B of e)fe.set(B,Ae),Ae+=B.length;const Te=it(fe);t.finalAudioUrl=URL.createObjectURL(Te),t.step="finished"}catch(S){console.error(S),t.error=S instanceof Error?S.message:"Failed during audio generation.",t.step="editing"}},rt=()=>{if(!t.finalAudioUrl)return;const e=document.createElement("a");e.href=t.finalAudioUrl,e.download=`${t.fileName.replace(".txt","")}.wav`,document.body.appendChild(e),e.click(),document.body.removeChild(e)};return ct(()=>he.value,e=>{e?ge.value=!0:setTimeout(()=>{ge.value=!1},1300)}),Re(()=>{ne(),G(),xe(),Xe(),window.addEventListener("resize",Ve)}),Ce(()=>{pe.value&&URL.revokeObjectURL(pe.value),ue.value&&URL.revokeObjectURL(ue.value),window.removeEventListener("resize",Ve)}),{currentUser:o,isAuthenticated:n,authLoading:i,showAuthModal:l,showProfileModal:r,authMode:f,currentView:g,noAudioCount:d,characterGenerated:P,playingResponse:p,currentIndex:v,liveAudioRef:m,characterImageRef:u,selectedVoice:E,selectedRole:T,selectedMood:k,selectedStyle:A,selectedCharacter:R,selectedDialogModel:C,selectedImageModel:j,selectedInterruptSensitivity:Z,characterVoiceDescription:I,characterVisualDescription:b,onGenerateCharacter:ce,selectCharacter:Oe,selectRole:Fe,selectMood:Ye,selectStyle:Ne,showShareModal:z,showRawModal:N,isCopied:V,copyToClipboard:_,getShareUrl:le,actualVoicePrompt:ee,actualImagePrompt:Se,isConnecting:M,handleNoAudio:qe,handleSpeakingStart:$e,handleExtendedQuiet:Ke,handleQuotaExceeded:Je,stopPlaybackAndReset:Qe,isEverythingSelected:Y,selectionPrompt:J,isInSession:oe,characterImageKey:H,toggleVoiceDropdown:ie,selectVoice:$,showVoiceDropdown:se,voiceOptions:te,selectedVoiceInfo:ke,regenerateImage:L,imageTimestamp:Ie,logoUrl:ue,showClickToRestartHelp:U,isPlayerVisible:he,isSmallScreen:be,isPlayerInDOM:ge,forceShowBottomMessage:W,categories:{Characters:{items:De,selected:R,select:Oe,getter:e=>({emoji:e.emoji,name:e.name.split(" ")[0]})},Roles:{items:Ue,selected:T,select:Fe,getter:e=>({emoji:e.emoji,name:null})},Moods:{items:K,selected:k,select:Ye,getter:e=>({emoji:e.emoji,name:null})},Styles:{items:Pe,selected:A,select:Ne,getter:e=>({emoji:e.emoji,name:null})}},CHARACTER_ATTRIBUTES:De,ROLE_ATTRIBUTES:Ue,MOOD_ATTRIBUTES:K,STYLE_ATTRIBUTES:Pe,audiobookState:t,resetAudiobookCreator:Ze,handleFileUpload:et,playPreviewLine:at,generateFullAudiobook:nt,downloadAudioFile:rt,generateAudiobookImage:ot,ART_STYLES:F,audiobookScriptWithScenes:ae}},template:`
    <div class="bg-blue w-full h-full flex flex-col items-center p-2 lg:p-4 text-black overflow-hidden font-sans">
      <header class="w-full flex justify-between items-center mb-2 lg:mb-4 px-2">
        <div class="flex items-center space-x-2">
          <img v-if="logoUrl" :src="logoUrl" class="w-8 h-8" alt="logo"/>
          <h1 class="text-xl lg:text-3xl font-bold">Audio Avatars</h1>
        </div>
        <div class="flex items-center space-x-4">
          <div class="bg-white/50 p-1 rounded-full flex text-sm">
             <button @click="(async ()=>{ currentView = 'avatars'; await loadView('avatars') })()" class="px-3 py-1 rounded-full transition-colors" :class="currentView === 'avatars' ? 'bg-black text-white' : 'hover:bg-black/10'">Avatars</button>
             <button @click="(async ()=>{ currentView = 'audiobook'; await loadView('audiobook') })()" class="px-3 py-1 rounded-full transition-colors" :class="currentView === 'audiobook' ? 'bg-black text-white' : 'hover:bg-black/10'">Audiobook Creator</button>
             <button @click="currentView = 'sentry-test'" class="px-3 py-1 rounded-full transition-colors" :class="currentView === 'sentry-test' ? 'bg-black text-white' : 'hover:bg-black/10'">Test Errors</button>
          </div>
          <div class="flex items-center space-x-2">
            <!-- Auth Buttons -->
            <button
              v-if="!isAuthenticated && !authLoading"
              @click="authMode = 'login'; showAuthModal = true"
              class="bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-full transition"
            >
              Sign In
            </button>
            <button
              v-if="isAuthenticated"
              @click="showProfileModal = true"
              class="bg-white/50 hover:bg-white text-black font-bold p-2 rounded-full aspect-square flex items-center justify-center"
              :title="currentUser?.displayName || 'Profile'"
            >
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>
            </button>
            <button @click="showShareModal = true" class="bg-white/50 hover:bg-white text-black font-bold p-2 rounded-full aspect-square flex items-center justify-center">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="18" cy="5" r="3"></circle><circle cx="6" cy="12" r="3"></circle><circle cx="18" cy="19" r="3"></circle><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line></svg>
            </button>
            <button @click="showRawModal = true" class="bg-white/50 hover:bg-white text-black font-bold p-2 rounded-full aspect-square flex items-center justify-center">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="16 18 22 12 16 6"></polyline><polyline points="8 6 2 12 8 18"></polyline></svg>
            </button>
          </div>
        </div>
      </header>

      <!-- Lazy-loaded Avatars view (code-split) -->
      <main v-if="currentView === 'avatars'" class="w-full flex-grow">
        <component v-if="AvatarsView" :is="AvatarsView" />
        <div v-else class="w-full flex-grow flex items-center justify-center p-8 text-gray-500">Loading avatars...</div>
      </main>

       <main v-if="currentView === 'audiobook'" class="w-full flex-grow">
         <component v-if="AudiobookView" :is="AudiobookView" />
         <div v-else class="w-full flex-grow flex items-center justify-center p-8 text-gray-500">Loading audiobook...</div>
       </main>
       <main v-if="currentView === 'sentry-test'" class="w-full flex-grow bg-white/50 rounded-wow">
         <SentryTestPage />
       </main>
        <!-- Step 1: Upload -->
        <div v-if="audiobookState.step === 'upload'" class="text-center">
          <h2 class="text-2xl font-bold mb-2">Audiobook Creator</h2>
          <p class="mb-4 text-black/60">Upload a chapter (.txt file) to get started.</p>
          <label class="bg-black text-white px-6 py-3 rounded-full font-bold cursor-pointer hover:bg-black/80 transition-colors">
            Upload Chapter
            <input type="file" @change="handleFileUpload" accept=".txt" class="hidden">
          </label>
           <p v-if="audiobookState.error" class="text-red-500 mt-4 max-w-md">{{ audiobookState.error }}</p>
        </div>

        <!-- Step 2: Parsing -->
        <div v-if="audiobookState.step === 'parsing'" class="text-center">
          <div class="relative w-16 h-16 mx-auto">
            <div class="absolute inset-0 border-8 border-black/20 rounded-full"></div>
            <div class="absolute inset-0 border-8 border-black rounded-full border-t-transparent animate-spin"></div>
          </div>
          <p class="mt-4 font-bold">Analyzing chapter, designing characters, and creating script...</p>
        </div>

        <!-- Step 3: Editing -->
        <div v-if="audiobookState.step === 'editing'" class="w-full h-full flex flex-col gap-4 overflow-hidden">
            <div class="flex-shrink-0 flex justify-between items-center">
                <div class="flex items-baseline gap-4">
                    <h2 class="text-xl font-bold">Production Studio</h2>
                    <p class="text-sm text-black/60">{{ audiobookState.fileName }}</p>
                </div>
                <div class="flex items-center gap-2">
                    <button @click="generateFullAudiobook" class="bg-black text-white font-bold py-2 px-5 rounded-full hover:bg-black/80">Generate Full Chapter</button>
                    <button @click="resetAudiobookCreator" class="bg-gray-200 text-black font-bold py-2 px-4 rounded-full hover:bg-gray-300 text-sm">Start New</button>
                </div>
            </div>
            <div class="flex-shrink-0 bg-black/10 p-1 rounded-full flex text-sm self-start">
                 <button @click="audiobookState.editingTab = 'voices'" class="px-4 py-1.5 rounded-full transition-colors text-sm font-semibold" :class="audiobookState.editingTab === 'voices' ? 'bg-white text-black' : 'hover:bg-black/10'">1. Cast Voices</button>
                 <button @click="audiobookState.editingTab = 'characters'" class="px-4 py-1.5 rounded-full transition-colors text-sm font-semibold" :class="audiobookState.editingTab === 'characters' ? 'bg-white text-black' : 'hover:bg-black/10'">2. Design Characters</button>
                 <button @click="audiobookState.editingTab = 'scenes'" class="px-4 py-1.5 rounded-full transition-colors text-sm font-semibold" :class="audiobookState.editingTab === 'scenes' ? 'bg-white text-black' : 'hover:bg-black/10'">3. Create Scenes</button>
            </div>

            <div class="flex-grow w-full bg-black/5 rounded-2xl p-4 overflow-y-auto">
                <!-- Tab 1: Voices -->
                <div v-if="audiobookState.editingTab === 'voices'">
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                      <div v-for="char in audiobookState.characters" :key="char.name" class="bg-white/50 p-3 rounded-xl">
                          <label class="font-bold text-md">{{ char.name }}</label>
                          <select v-model="audiobookState.voiceAssignments[char.name]" class="w-full p-2 mt-1 rounded-lg border-2 border-black/20 bg-white">
                              <option v-for="voice in voiceOptions" :key="voice.name" :value="voice.name">{{ voice.name }}</option>
                          </select>
                      </div>
                    </div>
                </div>
                <!-- Tab 2: Characters -->
                <div v-if="audiobookState.editingTab === 'characters'">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div v-for="char in audiobookState.characters" :key="char.name" class="bg-white/50 p-4 rounded-xl flex flex-col gap-3">
                            <h3 class="text-lg font-bold">{{ char.name }}</h3>
                            <p class="text-sm bg-black/5 p-2 rounded-md">{{ char.description }}</p>
                            <div class="flex gap-4">
                                <div class="flex-grow w-1/2">
                                    <label class="font-bold text-xs">Art Style</label>
                                    <select v-model="char.style" class="w-full p-2 mt-1 rounded-lg border-2 border-black/20 bg-white text-sm">
                                        <option v-for="style in ART_STYLES" :key="style" :value="style">{{ style }}</option>
                                    </select>
                                    <label class="font-bold text-xs mt-2 block">Image Prompt</label>
                                    <textarea v-model="char.prompt" rows="6" class="w-full p-2 mt-1 rounded-lg border-2 border-black/20 bg-white text-xs font-mono"></textarea>
                                    <button @click="generateAudiobookImage(char)" class="w-full mt-2 bg-purple text-white font-bold py-2 rounded-full text-sm hover:bg-purple/80" :disabled="char.isLoading">
                                        {{ char.isLoading ? 'Generating...' : 'Generate Portrait' }}
                                    </button>
                                </div>
                                <div class="w-1/2 aspect-square bg-black/10 rounded-lg flex items-center justify-center overflow-hidden">
                                     <div v-if="char.isLoading" class="relative w-10 h-10">
                                        <div class="absolute inset-0 border-4 border-black/20 rounded-full"></div>
                                        <div class="absolute inset-0 border-4 border-purple rounded-full border-t-transparent animate-spin"></div>
                                    </div>
                                    <img v-else-if="char.imageUrl" :src="char.imageUrl" class="w-full h-full object-cover"/>
                                    <p v-else class="text-xs text-black/40">Image will appear here</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Tab 3: Scenes -->
                <div v-if="audiobookState.editingTab === 'scenes'">
                     <div v-for="(item, index) in audiobookScriptWithScenes" :key="index" class="mb-2">
                        <div v-if="item.type === 'line'" class="flex items-center gap-3 p-2 rounded-lg hover:bg-black/10">
                           <button @click="playPreviewLine(item.data, index)" class="w-8 h-8 flex-shrink-0 rounded-full flex items-center justify-center" :class="audiobookState.currentlyPlayingLine === index ? 'bg-purple text-white' : 'bg-white'">
                              <svg v-if="audiobookState.currentlyPlayingLine === index" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="6" y="4" width="4" height="16"></rect><rect x="14" y="4" width="4" height="16"></rect></svg>
                              <svg v-else xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>
                           </button>
                           <p class="text-sm"><strong class="mr-2">{{ item.data.character }}:</strong>{{ item.data.line }}</p>
                        </div>
                        <div v-else-if="item.type === 'scene'" class="bg-white/50 my-4 p-4 rounded-xl border-l-4 border-purple">
                            <h4 class="font-bold text-purple mb-2">Scene Illustration</h4>
                            <div class="flex gap-4">
                               <div class="flex-grow w-1/2">
                                    <label class="font-bold text-xs mt-2 block">Image Prompt</label>
                                    <textarea v-model="item.data.prompt" rows="8" class="w-full p-2 mt-1 rounded-lg border-2 border-black/20 bg-white text-xs font-mono"></textarea>
                                    <button @click="generateAudiobookImage(item.data)" class="w-full mt-2 bg-purple text-white font-bold py-2 rounded-full text-sm hover:bg-purple/80" :disabled="item.data.isLoading">
                                        {{ item.data.isLoading ? 'Generating...' : 'Generate Scene' }}
                                    </button>
                                </div>
                                <div class="w-1/2 aspect-square bg-black/10 rounded-lg flex items-center justify-center overflow-hidden">
                                     <div v-if="item.data.isLoading" class="relative w-10 h-10">
                                        <div class="absolute inset-0 border-4 border-black/20 rounded-full"></div>
                                        <div class="absolute inset-0 border-4 border-purple rounded-full border-t-transparent animate-spin"></div>
                                    </div>
                                    <img v-else-if="item.data.imageUrl" :src="item.data.imageUrl" class="w-full h-full object-cover"/>
                                    <p v-else class="text-xs text-black/40">Image will appear here</p>
                                </div>
                            </div>
                        </div>
                     </div>
                </div>
            </div>
        </div>

        <!-- Step 4 & 5: Generating & Finished -->
        <div v-if="audiobookState.step === 'generating' || audiobookState.step === 'finished'" class="w-full max-w-lg text-center">
            <h2 class="text-2xl font-bold mb-4">{{ audiobookState.step === 'generating' ? 'Generating Your Audiobook' : 'Your Audiobook is Ready!' }}</h2>
            
            <div v-if="audiobookState.step === 'generating'" class="w-full bg-gray-200 rounded-full h-4 mb-4 overflow-hidden">
                <div class="bg-purple h-4 rounded-full" :style="{ width: audiobookState.generationProgress + '%' }"></div>
            </div>
            <p v-if="audiobookState.step === 'generating'" class="mb-4">Please wait, this may take a few minutes...</p>

            <div v-if="audiobookState.step === 'finished'">
                <audio controls :src="audiobookState.finalAudioUrl" class="w-full mb-4"></audio>
                <div class="flex gap-4">
                  <button @click="downloadAudioFile" class="flex-1 bg-black text-white font-bold py-3 rounded-full hover:bg-black/80">Download .WAV</button>
                  <button @click="resetAudiobookCreator" class="flex-1 bg-gray-200 text-black font-bold py-3 rounded-full hover:bg-gray-300">Create New Chapter</button>
                </div>
            </div>
        </div>

      </main>

      <div v-if="isPlayerVisible && isSmallScreen" class="fixed bottom-0 left-0 right-0 bg-blue p-2 border-t-2 border-white/50">
        <button @click="isPlayerVisible = false" class="w-full bg-white text-black p-3 rounded-2xl font-bold">Show Controls</button>
      </div>

      <LiveAudioComponent ref="liveAudioRef" @no-audio="handleNoAudio" @speaking-start="handleSpeakingStart" @extended-quiet="handleExtendedQuiet" @quota-exceeded="handleQuotaExceeded" />

      <!-- Share Modal -->
      <transition name="fade">
        <div v-if="showShareModal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50" @click="showShareModal = false">
          <div class="bg-white rounded-2xl p-6 w-full max-w-md" @click.stop>
            <h2 class="text-2xl font-bold mb-4">Share Character</h2>
            <p class="mb-4">Share a link to this specific character configuration.</p>
            <div class="flex space-x-2">
              <input type="text" :value="getShareUrl()" readonly class="flex-grow bg-gray-100 rounded-lg px-3 border border-gray-300">
              <button @click="copyToClipboard" class="bg-purple text-white px-4 py-2 rounded-lg font-bold">{{ isCopied ? 'Copied!' : 'Copy' }}</button>
            </div>
          </div>
        </div>
      </transition>
      
      <!-- Raw Prompts Modal -->
      <transition name="fade">
        <div v-if="showRawModal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50" @click="showRawModal = false">
          <div class="bg-white rounded-2xl p-6 w-full max-w-2xl max-h-[80vh] overflow-y-auto" @click.stop>
            <h2 class="text-2xl font-bold mb-4">Raw Prompts</h2>
            <div class="space-y-4">
              <div>
                <h3 class="font-bold">Voice Prompt:</h3>
                <p class="bg-gray-100 rounded-lg p-3 text-sm font-mono">{{ actualVoicePrompt }}</p>
              </div>
              <div>
                <h3 class="font-bold">Image Prompt:</h3>
                <p class="bg-gray-100 rounded-lg p-3 text-sm font-mono">{{ actualImagePrompt }}</p>
              </div>
            </div>
          </div>
        </div>
      </transition>

      <!-- Auth Modal -->
      <AuthModal
        :show="showAuthModal"
        :initialMode="authMode"
        @close="showAuthModal = false"
        @authenticated="showAuthModal = false"
      />

      <!-- User Profile Modal -->
      <UserProfile
        :show="showProfileModal"
        :user="currentUser"
        @close="showProfileModal = false"
        @signedOut="showProfileModal = false"
      />
    </div>
`}),Ge=st(Ot);try{const{initSentry:o}=require("./src/sentry");try{o(Ge)}catch(n){console.warn("Sentry helper threw:",(n==null?void 0:n.message)||n)}}catch{}function Me(o){const n=atob(o),i=n.length,l=new Uint8Array(i);for(let r=0;r<i;r++)l[r]=n.charCodeAt(r);return l}async function We(o,n,i,l){const r=new Int16Array(o.buffer),f=r.length/l,g=n.createBuffer(l,f,i);for(let d=0;d<l;d++){const P=g.getChannelData(d);for(let p=0;p<f;p++)P[p]=r[p*l+d]/32768}return g}function Ft(o){let n="";const i=o.byteLength;for(let l=0;l<i;l++)n+=String.fromCharCode(o[l]);return btoa(n)}function Yt(o){const n=o.length,i=new Int16Array(n);for(let l=0;l<n;l++)i[l]=o[l]*32768;return{data:Ft(new Uint8Array(i.buffer)),mimeType:"audio/pcm;rate=16000"}}At();Ge.mount("#app");
//# sourceMappingURL=index-qslsATDu.js.map
